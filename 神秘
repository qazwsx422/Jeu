-- DEATHNOTE å¡å¯†ç³»ç»Ÿ
-- å¡å¯†: mop134

local KeyAuth = {}
KeyAuth.Version = "1.1"  -- ç‰ˆæœ¬æ›´æ–°
KeyAuth.CorrectKey = "mop134"
KeyAuth.Attempts = 0
KeyAuth.MaxAttempts = 3
KeyAuth.Authorized = false
KeyAuth.UsedKeys = {}  -- å­˜å‚¨ä½¿ç”¨è¿‡çš„å¡å¯†

-- å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½å·²ä½¿ç”¨çš„å¡å¯†
local function LoadUsedKeys()
    local success, result = pcall(function()
        -- å°è¯•ä»DataStoreæˆ–å…¶å®ƒæŒä¹…åŒ–å­˜å‚¨åŠ è½½
        return game:GetService("HttpService"):JSONDecode(readfile("deathnote_keys.json"))
    end)
    if success and type(result) == "table" then
        KeyAuth.UsedKeys = result
    end
end

-- ä¿å­˜å·²ä½¿ç”¨çš„å¡å¯†åˆ°æœ¬åœ°å­˜å‚¨
local function SaveUsedKeys()
    pcall(function()
        writefile("deathnote_keys.json", game:GetService("HttpService"):JSONEncode(KeyAuth.UsedKeys))
    end)
end

-- åˆå§‹åŒ–æ—¶åŠ è½½å·²ä½¿ç”¨çš„å¡å¯†
LoadUsedKeys()

-- åˆ›å»ºå¡å¯†éªŒè¯ç•Œé¢
local KeyAuthGUI = Instance.new("ScreenGui")
KeyAuthGUI.Name = "KeyAuthSystem"
KeyAuthGUI.ResetOnSpawn = false
KeyAuthGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local UIGradient = Instance.new("UIGradient")
local Title = Instance.new("TextLabel")
local KeyInput = Instance.new("TextBox")
local SubmitBtn = Instance.new("TextButton")
local Status = Instance.new("TextLabel")
local AttemptsLabel = Instance.new("TextLabel")
local UsedKeysLabel = Instance.new("TextLabel")  -- æ–°å¢ï¼šæ˜¾ç¤ºå·²ä½¿ç”¨å¡å¯†

-- éšè”½ä½ç½®
KeyAuthGUI.Parent = game:GetService("CoreGui")

-- ä¸»æ¡†æ¶
MainFrame.Parent = KeyAuthGUI
MainFrame.Size = UDim2.new(0, 350, 0, 280)  -- å¢åŠ é«˜åº¦ä»¥å®¹çº³æ–°å…ƒç´ 
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -140)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MainFrame.BorderSizePixel = 0

-- æ ·å¼
UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0, 12)

UIGradient.Parent = MainFrame
UIGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25, 25, 35)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(15, 15, 20))
})

-- æ ‡é¢˜
Title.Parent = MainFrame
Title.Size = UDim2.new(1, 0, 0, 50)
Title.Position = UDim2.new(0, 0, 0, 10)
Title.BackgroundTransparency = 1
Title.Text = "ğŸ” DEATHNOTE è®¤è¯ç³»ç»Ÿ"
Title.TextColor3 = Color3.fromRGB(220, 220, 220)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold

-- å¡å¯†è¾“å…¥æ¡†
KeyInput.Parent = MainFrame
KeyInput.Size = UDim2.new(0, 280, 0, 40)
KeyInput.Position = UDim2.new(0.5, -140, 0.25, 0)
KeyInput.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
KeyInput.BorderSizePixel = 0
KeyInput.PlaceholderText = "è¯·è¾“å…¥å¡å¯†..."
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyInput.TextSize = 14
KeyInput.Font = Enum.Font.Gotham
KeyInput.ClearTextOnFocus = false

local InputCorner = Instance.new("UICorner")
InputCorner.Parent = KeyInput
InputCorner.CornerRadius = UDim.new(0, 8)

-- æäº¤æŒ‰é’®
SubmitBtn.Parent = MainFrame
SubmitBtn.Size = UDim2.new(0, 200, 0, 40)
SubmitBtn.Position = UDim2.new(0.5, -100, 0.5, 0)
SubmitBtn.BackgroundColor3 = Color3.fromRGB(65, 105, 225)
SubmitBtn.BorderSizePixel = 0
SubmitBtn.Text = "éªŒè¯å¡å¯†"
SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
SubmitBtn.TextSize = 14
SubmitBtn.Font = Enum.Font.GothamSemibold

local ButtonCorner = Instance.new("UICorner")
ButtonCorner.Parent = SubmitBtn
ButtonCorner.CornerRadius = UDim.new(0, 8)

-- çŠ¶æ€æ˜¾ç¤º
Status.Parent = MainFrame
Status.Size = UDim2.new(1, 0, 0, 20)
Status.Position = UDim2.new(0, 0, 0.7, 0)
Status.BackgroundTransparency = 1
Status.Text = "ç­‰å¾…è¾“å…¥..."
Status.TextColor3 = Color3.fromRGB(180, 180, 180)
Status.TextSize = 12
Status.Font = Enum.Font.Gotham

-- å°è¯•æ¬¡æ•°æ˜¾ç¤º
AttemptsLabel.Parent = MainFrame
AttemptsLabel.Size = UDim2.new(1, 0, 0, 20)
AttemptsLabel.Position = UDim2.new(0, 0, 0.75, 0)
AttemptsLabel.BackgroundTransparency = 1
AttemptsLabel.Text = "å‰©ä½™å°è¯•æ¬¡æ•°: 3"
AttemptsLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
AttemptsLabel.TextSize = 11
AttemptsLabel.Font = Enum.Font.Gotham

-- å·²ä½¿ç”¨å¡å¯†æ˜¾ç¤º
UsedKeysLabel.Parent = MainFrame
UsedKeysLabel.Size = UDim2.new(1, 0, 0, 30)
UsedKeysLabel.Position = UDim2.new(0, 0, 0.85, 0)
UsedKeysLabel.BackgroundTransparency = 1
UsedKeysLabel.Text = "å·²ä½¿ç”¨å¡å¯†: æ— "
UsedKeysLabel.TextColor3 = Color3.fromRGB(120, 120, 120)
UsedKeysLabel.TextSize = 10
UsedKeysLabel.Font = Enum.Font.Gotham
UsedKeysLabel.TextWrapped = true

-- æ›´æ–°å·²ä½¿ç”¨å¡å¯†æ˜¾ç¤º
local function UpdateUsedKeysDisplay()
    if #KeyAuth.UsedKeys > 0 then
        local displayText = "å·²ä½¿ç”¨å¡å¯†: "
        for i, key in ipairs(KeyAuth.UsedKeys) do
            if i <= 3 then  -- åªæ˜¾ç¤ºæœ€è¿‘3ä¸ª
                displayText = displayText .. key
                if i < math.min(#KeyAuth.UsedKeys, 3) then
                    displayText = displayText .. ", "
                end
            end
        end
        if #KeyAuth.UsedKeys > 3 then
            displayText = displayText .. " ..."
        end
        UsedKeysLabel.Text = displayText
    else
        UsedKeysLabel.Text = "å·²ä½¿ç”¨å¡å¯†: æ— "
    end
end

-- è®°å½•ä½¿ç”¨è¿‡çš„å¡å¯†
local function RecordUsedKey(key)
    -- æ£€æŸ¥æ˜¯å¦å·²ç»è®°å½•è¿‡
    for _, usedKey in ipairs(KeyAuth.UsedKeys) do
        if usedKey == key then
            return
        end
    end
    
    -- æ·»åŠ åˆ°è®°å½•åˆ—è¡¨
    table.insert(KeyAuth.UsedKeys, key)
    
    -- é™åˆ¶è®°å½•æ•°é‡ï¼ˆæœ€å¤š10ä¸ªï¼‰
    if #KeyAuth.UsedKeys > 10 then
        table.remove(KeyAuth.UsedKeys, 1)
    end
    
    -- ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    SaveUsedKeys()
    
    -- æ›´æ–°æ˜¾ç¤º
    UpdateUsedKeysDisplay()
end

-- å¡å¯†éªŒè¯å‡½æ•°
local function ValidateKey(inputKey)
    KeyAuth.Attempts = KeyAuth.Attempts + 1
    
    -- è®°å½•æ‰€æœ‰å°è¯•çš„å¡å¯†ï¼ˆæ— è®ºå¯¹é”™ï¼‰
    RecordUsedKey(inputKey)
    
    if inputKey == KeyAuth.CorrectKey then
        KeyAuth.Authorized = true
        Status.Text = "âœ… è®¤è¯æˆåŠŸï¼æ­£åœ¨åŠ è½½DEATHNOTE..."
        Status.TextColor3 = Color3.fromRGB(0, 255, 0)
        AttemptsLabel.Text = "æ¬¢è¿ä½¿ç”¨ DEATHNOTE"
        
        -- æŒ‰é’®æ•ˆæœ
        SubmitBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
        SubmitBtn.Text = "è®¤è¯æˆåŠŸ"
        
        -- å»¶è¿ŸååŠ è½½ä¸»ç•Œé¢
        wait(1.5)
        KeyAuthGUI:Destroy()
        LoadDeathNoteUI() -- åŠ è½½ä¸»ç•Œé¢
        
        return true
    else
        local remaining = KeyAuth.MaxAttempts - KeyAuth.Attempts
        AttemptsLabel.Text = "å‰©ä½™å°è¯•æ¬¡æ•°: " .. remaining
        
        if remaining <= 0 then
            Status.Text = "âŒ å°è¯•æ¬¡æ•°è¿‡å¤šï¼Œç³»ç»Ÿå…³é—­"
            Status.TextColor3 = Color3.fromRGB(255, 0, 0)
            SubmitBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
            SubmitBtn.Text = "å·²é”å®š"
            SubmitBtn.Active = false
            
            -- 5ç§’åå…³é—­
            wait(5)
            KeyAuthGUI:Destroy()
        else
            Status.Text = "âŒ å¡å¯†é”™è¯¯ï¼Œè¯·é‡è¯•"
            Status.TextColor3 = Color3.fromRGB(255, 100, 100)
            
            -- é”™è¯¯éœ‡åŠ¨æ•ˆæœ
            for i = 1, 3 do
                MainFrame.Position = MainFrame.Position + UDim2.new(0, 2, 0, 0)
                wait(0.05)
                MainFrame.Position = MainFrame.Position + UDim2.new(0, -4, 0, 0)
                wait(0.05)
                MainFrame.Position = MainFrame.Position + UDim2.new(0, 2, 0, 0)
            end
        end
        return false
    end
end

-- æäº¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
SubmitBtn.MouseButton1Click:Connect(function()
    if KeyInput.Text ~= "" then
        ValidateKey(KeyInput.Text)
    else
        Status.Text = "âš ï¸ è¯·è¾“å…¥å¡å¯†"
        Status.TextColor3 = Color3.fromRGB(255, 255, 0)
    end
end)

-- å›è½¦é”®æäº¤
KeyInput.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        if KeyInput.Text ~= "" then
            ValidateKey(KeyInput.Text)
        end
    end
end)

-- éšè—å¿«æ·é”®
game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
    if not processed then
        if input.KeyCode == Enum.KeyCode.F8 then
            MainFrame.Visible = not MainFrame.Visible
        elseif input.KeyCode == Enum.KeyCode.Escape then
            KeyAuthGUI:Destroy()
        end
    end
end)

-- åˆå§‹åŒ–æ˜¾ç¤º
UpdateUsedKeysDisplay()

-- åŠ è½½ä¸»ç•Œé¢çš„å‡½æ•°
function LoadDeathNoteUI()
    -- è¿™é‡Œæ˜¯ä½ çš„DEATHNOTEä¸»ç•Œé¢ä»£ç 
    local DeathNoteGUI = Instance.new("ScreenGui")
    DeathNoteGUI.Name = "DEATHNOTE_MAIN"
    DeathNoteGUI.ResetOnSpawn = false
    DeathNoteGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    DeathNoteGUI.Parent = game:GetService("CoreGui")
    
    local MainFrame = Instance.new("Frame")
    MainFrame.Parent = DeathNoteGUI
    MainFrame.Size = UDim2.new(0, 400, 0, 500)
    MainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
    MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    MainFrame.BorderSizePixel = 0
    
    local UICorner = Instance.new("UICorner")
    UICorner.Parent = MainFrame
    UICorner.CornerRadius = UDim.new(0, 12)
    
    -- æ ‡é¢˜
    local Title = Instance.new("TextLabel")
    Title.Parent = MainFrame
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.Position = UDim2.new(0, 0, 0, 10)
    Title.BackgroundTransparency = 1
    Title.Text = "ğŸ““ DEATHNOTE - è®¤è¯æˆåŠŸ"
    Title.TextColor3 = Color3.fromRGB(0, 255, 0)
    Title.TextSize = 18
    Title.Font = Enum.Font.GothamBold
    
    -- åŠŸèƒ½æŒ‰é’®
    local function CreateFeatureButton(text, yPos, color, callback)
        local button = Instance.new("TextButton")
        button.Parent = MainFrame
        button.Size = UDim2.new(0, 300, 0, 40)
        button.Position = UDim2.new(0.5, -150, yPos, 0)
        button.BackgroundColor3 = color
        button.BorderSizePixel = 0
        button.Text = text
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.TextSize = 14
        button.Font = Enum.Font.GothamSemibold
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.Parent = button
        btnCorner.CornerRadius = UDim.new(0, 8)
        
        button.MouseButton1Click:Connect(callback)
        return button
    end
    
    -- ä½ çš„è„šæœ¬åŠŸèƒ½
    CreateFeatureButton("âš¡ TexRBLlX è„šæœ¬", 0.15, Color3.fromRGB(65, 105, 225), function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/hdjsjjdgrhj/script-hub/refs/heads/main/TexRBLlX", true))()
    end)
    
    CreateFeatureButton("ğŸ”§ Pastebin è„šæœ¬", 0.25, Color3.fromRGB(50, 205, 50), function()
        loadstring(game:HttpGet("https://pastebin.com/raw/K5SmaZT4", true))()
    end)
    
    CreateFeatureButton("ğŸ‘» éšè—ç•Œé¢", 0.35, Color3.fromRGB(128, 0, 128), function()
        DeathNoteGUI.Enabled = not DeathNoteGUI.Enabled
    end)
    
    -- æŸ¥çœ‹ä½¿ç”¨è®°å½•æŒ‰é’®
    CreateFeatureButton("ğŸ“‹ æŸ¥çœ‹ä½¿ç”¨è®°å½•", 0.45, Color3.fromRGB(255, 140, 0), function()
        local recordText = "ğŸ“‹ å¡å¯†ä½¿ç”¨è®°å½•:\n"
        if #KeyAuth.UsedKeys > 0 then
            for i, key in ipairs(KeyAuth.UsedKeys) do
                local status = (key == KeyAuth.CorrectKey) and "âœ… æ­£ç¡®" or "âŒ é”™è¯¯"
                recordText = recordText .. string.format("%d. %s - %s\n", i, key, status)
            end
        else
            recordText = recordText .. "æš‚æ— è®°å½•"
        end
        
        -- æ˜¾ç¤ºè®°å½•å¼¹çª—
        warn(recordText)
    end)
    
    -- éšè—å¿«æ·é”®
    game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
        if not processed then
            if input.KeyCode == Enum.KeyCode.F9 then
                DeathNoteGUI.Enabled = not DeathNoteGUI.Enabled
            elseif input.KeyCode == Enum.KeyCode.F10 then
                DeathNoteGUI:Destroy()
            end
        end
    end)
    
    warn("ğŸ““ DEATHNOTE ä¸»ç•Œé¢å·²åŠ è½½")
    warn("ğŸ“‹ å·²è®°å½• " .. #KeyAuth.UsedKeys .. " ä¸ªå¡å¯†å°è¯•")
    warn("âš¡ F9 - éšè—/æ˜¾ç¤ºç•Œé¢")
    warn("âš¡ F10 - å…³é—­DEATHNOTE")
end

-- åˆå§‹åŒ–ä¿¡æ¯
warn("ğŸ” DEATHNOTE å¡å¯†ç³»ç»Ÿå·²å¯åŠ¨ v" .. KeyAuth.Version)
warn("ğŸ”‘ æ­£ç¡®å¡å¯†: mop134")
warn("ğŸ“ ç³»ç»Ÿä¼šè®°å½•æ‰€æœ‰å°è¯•çš„å¡å¯†")
warn("âš¡ F8 - éšè—è®¤è¯ç•Œé¢")
warn("âš¡ ESC - å…³é—­ç³»ç»Ÿ")
